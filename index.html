<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registro de Beb칠</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 400px;
      margin: auto;
    }
    label, select, input {
      display: block;
      width: 100%;
      margin-bottom: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #f4f4f4;
    }
    button {
      width: 100%;
      padding: 10px;
      background: #007BFF;
      color: white;
      border: none;
      cursor: pointer;
    }
  </style>
  <!-- Incluir Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Incluir plugin de timeline para Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-timeline@0.1.1/dist/chartjs-chart-timeline.min.js"></script>
</head>
<body>

  <h2>Registro de Actividades</h2>
  
  <label for="actividad">Actividad:</label>
  <select id="actividad">
    <option value="Teta">Teta</option>
    <option value="Mema">Mema</option>
    <option value="Pa침al">Pa침al</option>
    <option value="Despierta">Despierta</option>
    <option value="Duerme en Brazos">Duerme en Brazos</option>
    <option value="Duerme en Cuna">Duerme en Cuna</option>
  </select>

  <label for="fecha">Fecha y Hora:</label>
  <input type="datetime-local" id="fecha" />

  <label for="duracion">Duraci칩n (minutos):</label>
  <input type="number" id="duracion" value="5" min="1" />

  <button onclick="guardarActividad()">Guardar Actividad</button>

  <h3>Historial</h3>
  <table>
    <thead>
      <tr>
        <th>Fecha</th>
        <th>Actividad</th>
        <th>Duraci칩n</th>
        <th>Acci칩n</th>
      </tr>
    </thead>
    <tbody id="tablaHistorial"></tbody>
  </table>

  <h3>Visualizaci칩n del D칤a</h3>
  <label for="fechaFiltro">Selecciona la Fecha:</label>
  <input type="date" id="fechaFiltro" />
  <canvas id="timelineChart" width="400" height="200"></canvas>

  <script>
    // Pre-cargar la fecha y hora actual en el input
    document.getElementById("fecha").value = new Date().toISOString().slice(0, 16);
    // Establecer el filtro de fecha a hoy
    let todayStr = new Date().toISOString().split("T")[0];
    document.getElementById("fechaFiltro").value = todayStr;

    function guardarActividad() {
      const actividad = document.getElementById("actividad").value;
      const fecha = document.getElementById("fecha").value;
      const duracion = parseInt(document.getElementById("duracion").value) || 5;
      if (!actividad || !fecha) return alert("Complete todos los campos.");

      let historial = JSON.parse(localStorage.getItem("historialBebe")) || [];
      historial.push({ fecha, actividad, duracion });
      localStorage.setItem("historialBebe", JSON.stringify(historial));

      actualizarTabla();
      actualizarGrafico();
    }

    function actualizarTabla() {
      const historial = JSON.parse(localStorage.getItem("historialBebe")) || [];
      const tabla = document.getElementById("tablaHistorial");
      tabla.innerHTML = "";
      historial.forEach((item, index) => {
        const fila = `<tr>
          <td>${item.fecha}</td>
          <td>${item.actividad}</td>
          <td>${item.duracion} min</td>
          <td><button onclick="eliminarActividad(${index})">游딈</button></td>
        </tr>`;
        tabla.innerHTML += fila;
      });
    }

    function eliminarActividad(index) {
      let historial = JSON.parse(localStorage.getItem("historialBebe")) || [];
      historial.splice(index, 1);
      localStorage.setItem("historialBebe", JSON.stringify(historial));
      actualizarTabla();
      actualizarGrafico();
    }

    // Actualizar gr치fico seg칰n la fecha seleccionada
    function actualizarGrafico() {
      let filtro = document.getElementById("fechaFiltro").value;
      if (!filtro) {
        filtro = new Date().toISOString().split("T")[0];
        document.getElementById("fechaFiltro").value = filtro;
      }
      let historial = JSON.parse(localStorage.getItem("historialBebe")) || [];
      // Filtrar registros que pertenecen a la fecha elegida (comparando solo la parte de la fecha)
      let registrosFiltrados = historial.filter(record => {
        let recordDate = new Date(record.fecha).toISOString().split("T")[0];
        return recordDate === filtro;
      });
      
      // Construir los datos para el gr치fico usando el plugin timeline
      const colorMap = {
        'Teta': '#007bff',
        'Mema': '#ff69b4',
        'Pa침al': '#ffa500',
        'Despierta': '#ffff00',
        'Duerme en Brazos': '#800080',
        'Duerme en Cuna': '#008000'
      };
      
      let dataPoints = [];
      registrosFiltrados.forEach(record => {
        let start = new Date(record.fecha);
        let end = new Date(start.getTime() + record.duracion * 60000);
        dataPoints.push({
          x: start,
          x2: end,
          y: 'Actividades',
          label: record.actividad,
          backgroundColor: colorMap[record.actividad] || '#808080'
        });
      });
      
      // Si el gr치fico ya existe, actualiza los datos; si no, lo crea.
      if (window.timelineChart) {
        window.timelineChart.data.datasets[0].data = dataPoints;
        window.timelineChart.update();
      } else {
        const ctx = document.getElementById('timelineChart').getContext('2d');
        window.timelineChart = new Chart(ctx, {
          type: 'timeline',
          data: {
            datasets: [{
              label: 'Actividades',
              data: dataPoints
            }]
          },
          options: {
            scales: {
              x: {
                type: 'time',
                time: {
                  unit: 'minute',
                  displayFormats: {
                    minute: 'HH:mm'
                  }
                },
                title: {
                  display: true,
                  text: 'Hora'
                }
              },
              y: {
                type: 'category',
                labels: ['Actividades']
              }
            },
            plugins: {
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const point = context.raw;
                    const start = new Date(point.x);
                    const end = new Date(point.x2);
                    return point.label + ': ' + start.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) +
                           ' - ' + end.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                  }
                }
              }
            }
          }
        });
      }
    }

    // Actualizar gr치fico al cambiar la fecha del filtro
    document.getElementById("fechaFiltro").addEventListener("change", actualizarGrafico);

    // Inicializar tabla y gr치fico al cargar la p치gina
    actualizarTabla();
    actualizarGrafico();
  </script>
</body>
</html>
